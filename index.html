<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https:; connect-src 'self' https: wss: http:; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https: blob:;">
    <title>ë™ì›ê³¼ê¸°ëŒ€ AI ì…í•™ìƒë‹´ v6.4</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #0066CC 0%, #CC0000 50%, #FFB800 100%);
            height: 100vh;
            height: 100dvh; /* ëª¨ë°”ì¼ ë·°í¬íŠ¸ ë†’ì´ */
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
        }
        
        .header {
            background: white;
            padding: 10px 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-text {
            font-size: 0.9em;
            font-weight: bold;
            background: linear-gradient(135deg, #0066CC, #CC0000);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header-right {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .language-selector {
            padding: 5px 10px;
            border: 2px solid #0066CC;
            border-radius: 12px;
            background: white;
            color: #0066CC;
            font-size: 0.75em;
            font-weight: bold;
            cursor: pointer;
        }
        
        .call-button {
            background: linear-gradient(135deg, #0066CC, #0052A3);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            text-decoration: none;
            font-size: 0.75em;
            font-weight: bold;
        }
        
        .language-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .language-modal.active {
            display: flex;
        }
        
        .language-options {
            background: white;
            border-radius: 15px;
            padding: 20px;
            max-width: 90%;
            width: 300px;
        }
        
        .language-options h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #0066CC;
        }
        
        .language-option {
            padding: 12px;
            margin: 8px 0;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .language-option:hover {
            border-color: #0066CC;
            background: #f0f7ff;
        }
        
        .language-option.selected {
            border-color: #0066CC;
            background: linear-gradient(135deg, #0066CC, #0052A3);
            color: white;
        }
        
        .language-flag {
            font-size: 1.5em;
            margin-right: 8px;
        }
        
        .chat-container {
            flex: 1;
            background: white;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin: 8px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .chat-header {
            background: linear-gradient(135deg, #0066CC 0%, #CC0000 50%, #FFB800 100%);
            color: white;
            padding: 15px 12px;
            text-align: center;
        }
        
        .chat-header h1 {
            font-size: 1.1em;
            margin-bottom: 2px;
        }
        
        .chat-header p {
            font-size: 0.75em;
            opacity: 0.9;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            background: #f7f9fc;
        }
        
        .message {
            margin-bottom: 12px;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .bot-message {
            display: flex;
            justify-content: flex-start;
        }
        
        .user-message {
            display: flex;
            justify-content: flex-end;
        }
        
        .message-content {
            max-width: 85%;
            padding: 10px 13px;
            border-radius: 15px;
            line-height: 1.5;
            word-wrap: break-word;
            font-size: 0.85em;
        }
        
        .bot-message .message-content {
            background: white;
            color: #333;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        }
        
        .user-message .message-content {
            background: linear-gradient(135deg, #0066CC, #0052A3);
            color: white;
        }
        
        .message-content a {
            color: #0066CC;
            text-decoration: none;
            font-weight: bold;
        }
        
        .chat-input-area {
            padding: 10px 12px;
            padding-bottom: max(10px, env(safe-area-inset-bottom));
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 8px;
            position: sticky;
            bottom: 0;
        }
        
        .chat-input {
            flex: 1;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 18px;
            font-size: 14px;
            outline: none;
        }
        
        .chat-input:focus {
            border-color: #0066CC;
        }
        
        .send-button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #0066CC, #0052A3);
            color: white;
            border: none;
            border-radius: 18px;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
        }
        
        .send-button:active {
            transform: scale(0.95);
        }
        
        .send-button:disabled {
            opacity: 0.5;
        }
        
        .consult-button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            border-radius: 18px;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            margin-left: 8px;
        }
        
        .consult-button:active {
            transform: scale(0.95);
        }
        
        .consult-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .consult-modal.active {
            display: flex;
        }
        
        .consult-form {
            background: white;
            border-radius: 15px;
            padding: 20px;
            max-width: 90%;
            width: 350px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .consult-form h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #0066CC;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
            font-size: 0.9em;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #0066CC;
        }
        
        .form-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .form-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
        }
        
        .submit-consult {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .cancel-consult {
            background: #e5e7eb;
            color: #374151;
        }
        
        .loading {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #0066CC;
            animation: loading 1.4s infinite ease-in-out both;
            margin: 0 2px;
        }
        
        .loading:nth-child(1) { animation-delay: -0.32s; }
        .loading:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes loading {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        
        .chat-messages::-webkit-scrollbar {
            width: 4px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 4px;
        }

        .setup-notice {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 12px;
            margin: 10px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo-text">DIST ì…í•™ìƒë‹´</div>
        <div class="header-right">
            <button class="language-selector" id="languageBtn">ğŸŒ í•œêµ­ì–´</button>
            <a href="tel:055-370-8226" class="call-button">ğŸ“ ìƒë‹´ì „í™”</a>
        </div>
    </div>
    
    <div class="language-modal" id="languageModal">
        <div class="language-options">
            <h3>Select Language</h3>
            <div class="language-option selected" data-lang="ko">
                <span class="language-flag">ğŸ‡°ğŸ‡·</span>
                <span>í•œêµ­ì–´ (Korean)</span>
            </div>
            <div class="language-option" data-lang="en">
                <span class="language-flag">ğŸ‡ºğŸ‡¸</span>
                <span>English</span>
            </div>
            <div class="language-option" data-lang="zh">
                <span class="language-flag">ğŸ‡¨ğŸ‡³</span>
                <span>ä¸­æ–‡ (Chinese)</span>
            </div>
            <div class="language-option" data-lang="vi">
                <span class="language-flag">ğŸ‡»ğŸ‡³</span>
                <span>Tiáº¿ng Viá»‡t (Vietnamese)</span>
            </div>
            <div class="language-option" data-lang="ja">
                <span class="language-flag">ğŸ‡¯ğŸ‡µ</span>
                <span>æ—¥æœ¬èª (Japanese)</span>
            </div>
            <div class="language-option" data-lang="uz">
                <span class="language-flag">ğŸ‡ºğŸ‡¿</span>
                <span>O'zbek (Uzbek)</span>
            </div>
            <div class="language-option" data-lang="bn">
                <span class="language-flag">ğŸ‡§ğŸ‡©</span>
                <span>à¦¬à¦¾à¦‚à¦²à¦¾ (Bengali)</span>
            </div>
        </div>
    </div>
    
    <div class="consult-modal" id="consultModal">
        <div class="consult-form">
            <h3 id="consultTitle">ğŸ“ ìƒë‹´ì‹ ì²­</h3>
            <div class="form-group">
                <label id="consultNameLabel">ì´ë¦„ *</label>
                <input type="text" id="consultName" placeholder="" required>
            </div>
            <div class="form-group">
                <label id="consultPhoneLabel">ì—°ë½ì²˜ *</label>
                <input type="tel" id="consultPhone" placeholder="010-1234-5678" required>
            </div>
            <div class="form-group">
                <label id="consultDeptLabel">ê´€ì‹¬ í•™ê³¼ *</label>
                <select id="consultDept" required>
                    <option value="" id="consultDeptPlaceholder">í•™ê³¼ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                    <optgroup id="healthGroup" label="ë³´ê±´í•™ë¶€">
                        <option value="ê°„í˜¸í•™ê³¼">ê°„í˜¸í•™ê³¼</option>
                        <option value="ì•ˆê²½ê´‘í•™ê³¼">ì•ˆê²½ê´‘í•™ê³¼</option>
                        <option value="ë³´ê±´ì˜ë£Œí–‰ì •ê³¼">ë³´ê±´ì˜ë£Œí–‰ì •ê³¼</option>
                    </optgroup>
                    <optgroup id="aviationGroup" label="í•­ê³µëª¨ë¹Œë¦¬í‹°í•™ë¶€">
                        <option value="í•­ê³µì •ë¹„ê³¼">í•­ê³µì •ë¹„ê³¼(3ë…„ì œ)</option>
                        <option value="í•­ê³µì •ë¹„ê³¼(ì•¼ê°„)">í•­ê³µì •ë¹„ê³¼(ì•¼ê°„)</option>
                    </optgroup>
                    <optgroup id="engineeringGroup" label="ì²¨ë‹¨ê³µí•™ë¶€">
                        <option value="ë©”ì¹´íŠ¸ë¡œë‹‰ìŠ¤ê³¼">ë©”ì¹´íŠ¸ë¡œë‹‰ìŠ¤ê³¼</option>
                        <option value="ì„ ë°•ë™ë ¥ê¸°ê³„ê³¼">ì„ ë°•ë™ë ¥ê¸°ê³„ê³¼</option>
                        <option value="AIê¸°ê³„ì œì–´ê³¼">AIê¸°ê³„ì œì–´ê³¼</option>
                        <option value="ëƒ‰ë™ê³µì¡°ì„¤ë¹„ê³¼">ëƒ‰ë™ê³µì¡°ì„¤ë¹„ê³¼</option>
                        <option value="ì‚°ì—…ì•ˆì „ê´€ë¦¬ê³¼">ì‚°ì—…ì•ˆì „ê´€ë¦¬ê³¼</option>
                    </optgroup>
                    <optgroup id="hotelGroup" label="í˜¸í…”ì¡°ë¦¬ê´€ê´‘í•™ë¶€">
                        <option value="í˜¸í…”ì™¸ì‹ì¡°ë¦¬ê³¼">í˜¸í…”ì™¸ì‹ì¡°ë¦¬ê³¼</option>
                        <option value="ì™¸ì‹ì¡°ë¦¬ì°½ì—…ê³¼(ì•¼ê°„)">ì™¸ì‹ì¡°ë¦¬ì°½ì—…ê³¼(ì•¼ê°„)</option>
                        <option value="ë””ì €íŠ¸ì¹´í˜ì°½ì—…ê³¼">ë””ì €íŠ¸ì¹´í˜ì°½ì—…ê³¼</option>
                        <option value="í˜¸í…”ì‹í’ˆì œê³¼ì œë¹µê³¼">í˜¸í…”ì‹í’ˆì œê³¼ì œë¹µê³¼</option>
                    </optgroup>
                    <optgroup id="beautyGroup" label="ë¯¸ìš©ì˜ˆìˆ í•™ë¶€">
                        <option value="í—¤ì–´ë””ìì¸ê³¼">í—¤ì–´ë””ìì¸ê³¼</option>
                        <option value="ìƒí™œë¬¸í™”ì˜ˆìˆ ê³¼">ìƒí™œë¬¸í™”ì˜ˆìˆ ê³¼</option>
                    </optgroup>
                    <optgroup id="sportsGroup" label="ìŠ¤í¬ì¸ ì¬í™œí•™ë¶€">
                        <option value="ìŠ¤í¬ì¸ ì¬í™œìš´ë™ê³¼">ìŠ¤í¬ì¸ ì¬í™œìš´ë™ê³¼</option>
                        <option value="ì „ë¬¸ìŠ¤í¬ì¸ ì§€ë„ê³¼">ì „ë¬¸ìŠ¤í¬ì¸ ì§€ë„ê³¼</option>
                    </optgroup>
                    <optgroup id="humanitiesGroup" label="ì¸ë¬¸ì‚¬íšŒí•™ë¶€">
                        <option value="ìœ ì•„êµìœ¡ê³¼(3ë…„ì œ)">ìœ ì•„êµìœ¡ê³¼(3ë…„ì œ)</option>
                        <option value="ì‚¬íšŒë³µì§€ê³¼">ì‚¬íšŒë³µì§€ê³¼</option>
                        <option value="ë³´ê±´ë³µì§€ê³¼">ë³´ê±´ë³µì§€ê³¼</option>
                    </optgroup>
                    <optgroup id="generalGroup" label="ì¼ë°˜ìƒë‹´">
                        <option value="ì…í•™í™ë³´ì²˜">ì…í•™í™ë³´ì²˜</option>
                    </optgroup>
                </select>
            </div>
            <div class="form-group">
                <label id="consultMessageLabel">ë¬¸ì˜ë‚´ìš© (ì„ íƒ)</label>
                <input type="text" id="consultMessage" placeholder="">
            </div>
            <div class="form-buttons">
                <button class="cancel-consult" id="cancelBtn" onclick="closeConsultModal()">ì·¨ì†Œ</button>
                <button class="submit-consult" id="submitBtn" onclick="submitConsult()">ìƒë‹´ì‹ ì²­</button>
            </div>
        </div>
    </div>
    
    <div class="chat-container">
        <div class="chat-header">
            <h1 id="chatTitle">ğŸ¤– AI ì…í•™ìƒë‹´</h1>
            <p id="chatSubtitle">ë‚´ì‹  ë“±ê¸‰ë³„ ë§ì¶¤ í•™ê³¼ ì¶”ì²œ</p>
        </div>

        <div class="chat-messages" id="chatMessages"></div>
        
        <div class="chat-input-area">
            <input type="text" class="chat-input" id="userInput" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." />
            <button class="consult-button" id="consultButton" onclick="openConsultModal()">ğŸ“ ìƒë‹´</button>
            <button class="send-button" id="sendButton">ì „ì†¡</button>
        </div>
    </div>

    <script>
        // ========================================
        // âœ… ì„¤ì •: Cloudflare Worker URL
        // ========================================
        const PROXY_API_URL = 'https://gemini-proxy.jhd8946.workers.dev';
        
        // í•™ê³¼ë³„ ìƒë‹´êµìˆ˜ ì •ë³´ (2026í•™ë…„ë„ ê¸°ì¤€)
        const PROFESSORS = {
            'ê°„í˜¸í•™ê³¼': { name: 'ê¹€ì†¡ìˆœ', phone: '010-4662-6209', office: '055-370-8243' },
            'ì•ˆê²½ê´‘í•™ê³¼': { name: 'ìœ¤ë¯¸ì˜¥', phone: '010-8931-7214', office: '055-370-8214' },
            'ë³´ê±´ì˜ë£Œí–‰ì •ê³¼': { name: 'ì´ìŠ¹ì¬', phone: '010-5895-4862', office: '055-370-8197' },
            'í•­ê³µì •ë¹„ê³¼': { name: 'ë°°ê·œí•œ', phone: '010-6511-5235', office: '055-370-8318' },
            'í•­ê³µì •ë¹„ê³¼(ì•¼ê°„)': { name: 'ê¹€ì„±ìš°', phone: '010-5626-5877', office: '055-370-8311' },
            'ë©”ì¹´íŠ¸ë¡œë‹‰ìŠ¤ê³¼': { name: 'ì´í•™ì›', phone: '010-3680-9833', office: '055-370-8371' },
            'ì„ ë°•ë™ë ¥ê¸°ê³„ê³¼': { name: 'ë°•ì§€ì–¸', phone: '010-6585-3163', office: '055-370-8290' },
            'AIê¸°ê³„ì œì–´ê³¼': { name: 'ì´í•™ì›', phone: '010-3680-9833', office: '055-370-8371' },
            'ëƒ‰ë™ê³µì¡°ì„¤ë¹„ê³¼': { name: 'ì´ì •í˜„', phone: '010-8569-8819', office: '055-370-8167' },
            'ì‚°ì—…ì•ˆì „ê´€ë¦¬ê³¼': { name: 'ê³ ê²½ì°¬', phone: '010-4570-6993', office: '055-370-8195' },
            'í˜¸í…”ì™¸ì‹ì¡°ë¦¬ê³¼': { name: 'ì¥ìš©í˜„', phone: '010-4561-2259', office: '055-370-8146' },
            'ì™¸ì‹ì¡°ë¦¬ì°½ì—…ê³¼(ì•¼ê°„)': { name: 'ì¥ìš©í˜„', phone: '010-4561-2259', office: '055-370-8146' },
            'ë””ì €íŠ¸ì¹´í˜ì°½ì—…ê³¼': { name: 'êµ¬ì˜ë•', phone: '010-5531-8283', office: '055-370-8283' },
            'í˜¸í…”ì‹í’ˆì œê³¼ì œë¹µê³¼': { name: 'ì •ë™ìœ¤', phone: '010-3698-3835', office: '055-370-8140' },
            'í—¤ì–´ë””ìì¸ê³¼': { name: 'ìœ¤ëŒ€ìˆ˜', phone: '010-4097-4747', office: '055-370-8184' },
            'ìœ ì•„êµìœ¡ê³¼(3ë…„ì œ)': { name: 'í•˜ì •ì—°', phone: '010-7582-0037', office: '055-370-8136' },
            'ì‚¬íšŒë³µì§€ê³¼': { name: 'ì¡°ì¬í•„', phone: '010-6513-0697', office: '055-370-8279' },
            'ë³´ê±´ë³µì§€ê³¼': { name: 'ì´ì„ ì°¬', phone: '010-2568-8367', office: '055-370-8198' },
            'ìŠ¤í¬ì¸ ì¬í™œìš´ë™ê³¼': { name: 'ì¡°ì˜ê°‘', phone: '010-8818-5511', office: '055-370-8270' },
            'ì „ë¬¸ìŠ¤í¬ì¸ ì§€ë„ê³¼': { name: 'ì¡°ì˜ê°‘', phone: '010-8818-5511', office: '055-370-8270' },
            'ìƒí™œë¬¸í™”ì˜ˆìˆ ê³¼': { name: 'ê³ ì˜í˜¸', phone: '010-2585-0206', office: '055-370-8192' },
            'ì…í•™í™ë³´ì²˜': { name: 'ì…í•™í™ë³´ì²˜', phone: '055-370-8226', office: '055-370-8226' }
        };
        
        const UI_TRANSLATIONS = {
            ko: {
                chatTitle: 'ğŸ¤– AI ì…í•™ìƒë‹´',
                chatSubtitle: 'ë‚´ì‹  ë“±ê¸‰ë³„ ë§ì¶¤ í•™ê³¼ ì¶”ì²œ',
                inputPlaceholder: 'ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...',
                sendButton: 'ì „ì†¡',
                languageButton: 'ğŸŒ í•œêµ­ì–´'
            },
            en: {
                chatTitle: 'ğŸ¤– AI Admissions Counseling',
                chatSubtitle: 'Personalized Department Recommendations',
                inputPlaceholder: 'Type your question...',
                sendButton: 'Send',
                languageButton: 'ğŸŒ English'
            },
            zh: {
                chatTitle: 'ğŸ¤– AI å…¥å­¦å’¨è¯¢',
                chatSubtitle: 'æ ¹æ®æˆç»©æ¨èä¸“ä¸š',
                inputPlaceholder: 'è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...',
                sendButton: 'å‘é€',
                languageButton: 'ğŸŒ ä¸­æ–‡'
            },
            vi: {
                chatTitle: 'ğŸ¤– TÆ° váº¥n tuyá»ƒn sinh AI',
                chatSubtitle: 'Gá»£i Ã½ khoa há»c phÃ¹ há»£p',
                inputPlaceholder: 'Nháº­p cÃ¢u há»i cá»§a báº¡n...',
                sendButton: 'Gá»­i',
                languageButton: 'ğŸŒ Tiáº¿ng Viá»‡t'
            },
            ja: {
                chatTitle: 'ğŸ¤– AIå…¥å­¦ç›¸è«‡',
                chatSubtitle: 'æˆç¸¾åˆ¥å­¦ç§‘æ¨è–¦',
                inputPlaceholder: 'è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...',
                sendButton: 'é€ä¿¡',
                languageButton: 'ğŸŒ æ—¥æœ¬èª'
            },
            uz: {
                chatTitle: 'ğŸ¤– AI qabul maslahat',
                chatSubtitle: "Baholar bo'yicha mutaxassislik tavsiyasi",
                inputPlaceholder: 'Savolingizni kiriting...',
                sendButton: 'Yuborish',
                languageButton: "ğŸŒ O'zbek"
            },
            bn: {
                chatTitle: 'ğŸ¤– à¦à¦†à¦‡ à¦­à¦°à§à¦¤à¦¿ à¦ªà¦°à¦¾à¦®à¦°à§à¦¶',
                chatSubtitle: 'à¦—à§à¦°à§‡à¦¡ à¦…à¦¨à§à¦¯à¦¾à¦¯à¦¼à§€ à¦¬à¦¿à¦­à¦¾à¦— à¦¸à§à¦ªà¦¾à¦°à¦¿à¦¶',
                inputPlaceholder: 'à¦†à¦ªà¦¨à¦¾à¦° à¦ªà§à¦°à¦¶à§à¦¨ à¦²à¦¿à¦–à§à¦¨...',
                sendButton: 'à¦ªà¦¾à¦ à¦¾à¦¨',
                languageButton: 'ğŸŒ à¦¬à¦¾à¦‚à¦²à¦¾'
            }
        };
        
        // ìƒë‹´ í¼ ë‹¤êµ­ì–´ í…ìŠ¤íŠ¸
        const CONSULT_FORM_TEXT = {
            ko: {
                title: "ğŸ“ ìƒë‹´ì‹ ì²­", nameLabel: "ì´ë¦„ *", namePlaceholder: "ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”",
                phoneLabel: "ì—°ë½ì²˜ *", phonePlaceholder: "010-1234-5678", deptLabel: "ê´€ì‹¬ í•™ê³¼ *",
                deptPlaceholder: "í•™ê³¼ë¥¼ ì„ íƒí•˜ì„¸ìš”", messageLabel: "ë¬¸ì˜ë‚´ìš© (ì„ íƒ)",
                messagePlaceholder: "ê¶ê¸ˆí•œ ë‚´ìš©ì„ ê°„ë‹¨íˆ ì ì–´ì£¼ì„¸ìš”", cancelBtn: "ì·¨ì†Œ", submitBtn: "ìƒë‹´ì‹ ì²­"
            },
            en: {
                title: "ğŸ“ Consultation", nameLabel: "Name *", namePlaceholder: "Enter name",
                phoneLabel: "Phone *", phonePlaceholder: "010-1234-5678", deptLabel: "Department *",
                deptPlaceholder: "Select department", messageLabel: "Inquiry (Optional)",
                messagePlaceholder: "Brief description", cancelBtn: "Cancel", submitBtn: "Submit"
            },
            zh: {
                title: "ğŸ“ å’¨è¯¢ç”³è¯·", nameLabel: "å§“å *", namePlaceholder: "è¯·è¾“å…¥å§“å",
                phoneLabel: "è”ç³»æ–¹å¼ *", phonePlaceholder: "010-1234-5678", deptLabel: "ä¸“ä¸š *",
                deptPlaceholder: "è¯·é€‰æ‹©ä¸“ä¸š", messageLabel: "å’¨è¯¢å†…å®¹ï¼ˆå¯é€‰ï¼‰",
                messagePlaceholder: "ç®€è¦è¯´æ˜", cancelBtn: "å–æ¶ˆ", submitBtn: "æäº¤"
            },
            vi: {
                title: "ğŸ“ TÆ° váº¥n", nameLabel: "Há» tÃªn *", namePlaceholder: "Nháº­p tÃªn",
                phoneLabel: "Sá»‘ ÄT *", phonePlaceholder: "010-1234-5678", deptLabel: "Khoa *",
                deptPlaceholder: "Chá»n khoa", messageLabel: "Ná»™i dung (TÃ¹y chá»n)",
                messagePlaceholder: "MÃ´ táº£ ngáº¯n", cancelBtn: "Há»§y", submitBtn: "Gá»­i"
            },
            ja: {
                title: "ğŸ“ ç›¸è«‡ç”³è«‹", nameLabel: "ãŠåå‰ *", namePlaceholder: "åå‰ã‚’å…¥åŠ›",
                phoneLabel: "é€£çµ¡å…ˆ *", phonePlaceholder: "010-1234-5678", deptLabel: "å­¦ç§‘ *",
                deptPlaceholder: "å­¦ç§‘ã‚’é¸æŠ", messageLabel: "å†…å®¹ï¼ˆä»»æ„ï¼‰",
                messagePlaceholder: "ç°¡å˜ãªèª¬æ˜", cancelBtn: "ã‚­ãƒ£ãƒ³ã‚»ãƒ«", submitBtn: "ç”³è«‹"
            },
            uz: {
                title: "ğŸ“ Maslahat", nameLabel: "Ism *", namePlaceholder: "Ism kiriting",
                phoneLabel: "Telefon *", phonePlaceholder: "010-1234-5678", deptLabel: "Bo'lim *",
                deptPlaceholder: "Bo'limni tanlang", messageLabel: "Savol (Ixtiyoriy)",
                messagePlaceholder: "Qisqa tavsif", cancelBtn: "Bekor qilish", submitBtn: "Yuborish"
            },
            bn: {
                title: "ğŸ“ à¦ªà¦°à¦¾à¦®à¦°à§à¦¶", nameLabel: "à¦¨à¦¾à¦® *", namePlaceholder: "à¦¨à¦¾à¦® à¦²à¦¿à¦–à§à¦¨",
                phoneLabel: "à¦«à§‹à¦¨ *", phonePlaceholder: "010-1234-5678", deptLabel: "à¦¬à¦¿à¦­à¦¾à¦— *",
                deptPlaceholder: "à¦¬à¦¿à¦­à¦¾à¦— à¦¨à¦¿à¦°à§à¦¬à¦¾à¦šà¦¨", messageLabel: "à¦¬à¦¿à¦·à¦¯à¦¼ (à¦à¦šà§à¦›à¦¿à¦•)",
                messagePlaceholder: "à¦¸à¦‚à¦•à§à¦·à¦¿à¦ªà§à¦¤ à¦¬à¦¿à¦¬à¦°à¦£", cancelBtn: "à¦¬à¦¾à¦¤à¦¿à¦²", submitBtn: "à¦œà¦®à¦¾"
            }
        };
        
        const WELCOME_MESSAGES = {
            ko: `ì•ˆë…•í•˜ì„¸ìš”! ğŸ˜Š
ë™ì›ê³¼ê¸°ëŒ€ AI ì…í•™ìƒë‹´ì…ë‹ˆë‹¤.

ë¬´ì—‡ì´ ê¶ê¸ˆí•˜ì‹ ê°€ìš”?

ì˜ˆ) "ë‚´ì‹  5ë“±ê¸‰ ê°ˆ ìˆ˜ ìˆëŠ” í•™ê³¼?"`,
            en: `Hello! ğŸ˜Š
DIST AI Admissions Counseling.

How can I help you?

Ex) "Which departments for grade 5?"`,
            zh: `æ‚¨å¥½ï¼ğŸ˜Š
ä¸œå›­ç§‘æŠ€å¤§å­¦AIå…¥å­¦å’¨è¯¢ã€‚

æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨ï¼Ÿ

ä¾‹ï¼‰"5çº§æˆç»©å¯ä»¥ä¸Šä»€ä¹ˆä¸“ä¸šï¼Ÿ"`,
            vi: `Xin chÃ o! ğŸ˜Š
TÆ° váº¥n tuyá»ƒn sinh DIST.

TÃ´i cÃ³ thá»ƒ giÃºp gÃ¬?

VD) "Khoa nÃ o cho Ä‘iá»ƒm 5?"`,
            ja: `ã“ã‚“ã«ã¡ã¯ï¼ğŸ˜Š
æ±åœ’ç§‘æŠ€å¤§å­¦AIå…¥å­¦ç›¸è«‡ã§ã™ã€‚

ä½•ã‹ãŠæ‰‹ä¼ã„ã§ãã¾ã™ã‹ï¼Ÿ

ä¾‹ï¼‰ã€Œæˆç¸¾5ã§å…¥ã‚Œã‚‹å­¦ç§‘ã¯ï¼Ÿã€`,
            uz: `Assalomu alaykum! ğŸ˜Š
DIST qabul maslahat.

Sizga qanday yordam bera olaman?

Misol) "5 baho uchun qaysi mutaxassislik?"`,
            bn: `à¦¹à§à¦¯à¦¾à¦²à§‹! ğŸ˜Š
DIST à¦­à¦°à§à¦¤à¦¿ à¦ªà¦°à¦¾à¦®à¦°à§à¦¶à¥¤

à¦†à¦®à¦¿ à¦•à§€à¦­à¦¾à¦¬à§‡ à¦¸à¦¾à¦¹à¦¾à¦¯à§à¦¯ à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à¦¿?

à¦‰à¦¦à¦¾à¦¹à¦°à¦£) "à§« à¦—à§à¦°à§‡à¦¡à§‡à¦° à¦œà¦¨à§à¦¯ à¦•à§‹à¦¨ à¦¬à¦¿à¦­à¦¾à¦—?"`
        };
        
        const ADMISSION_DATABASE = `
Dongwon Institute of Science and Technology (DIST) Admissions Information

IMPORTANT: School Name Translations
- Korean: ë™ì›ê³¼í•™ê¸°ìˆ ëŒ€í•™êµ
- English: Dongwon Institute of Science and Technology (DIST)
- Japanese: æ±åœ’ç§‘å­¦æŠ€è¡“å¤§å­¦ (NOT æ±åŸ!)
- Chinese (Simplified): ä¸œå›­ç§‘å­¦æŠ€æœ¯å¤§å­¦
- Vietnamese: TrÆ°á»ng Äáº¡i há»c Khoa há»c vÃ  CÃ´ng nghá»‡ Dongwon
- Uzbek: Dongwon Fan va Texnologiya Instituti
- Bengali: à¦¡à¦‚à¦“à¦¯à¦¼à¦¨ à¦¬à¦¿à¦œà§à¦à¦¾à¦¨ à¦“ à¦ªà§à¦°à¦¯à§à¦•à§à¦¤à¦¿ à¦‡à¦¨à¦¸à§à¦Ÿà¦¿à¦Ÿà¦¿à¦‰à¦Ÿ

# Department Recommendations by Grade Level

## Grades 1-2 (Top Tier)
- Nursing (avg 3.5) - High employment, stable career
- Early Childhood Education (avg 3.8) - 3-year program, teaching license
- Optometry (avg 4.1) - Professional license, good income

## Grades 3-4 (High Tier)
- Optometry (avg 4.1)
- Aircraft Maintenance (avg 4.5) - Technical expertise, aviation industry
- Early Childhood Education (avg 3.8)
- Sports Rehabilitation & Exercise (avg 4.0) - Growing field
- Hotel & Culinary Arts (avg 4.2) - Hands-on skills
- Health Administration (avg 4.3)
- Professional Sports Coaching (avg 4.0)

## Grades 5-6 (Mid Tier) â˜…Recommended for International Studentsâ˜…
- Refrigeration & Air Conditioning (avg 5.0) - High demand, practical skills
- Mechatronics (avg 5.2) - Industry 4.0, automation
- Industrial Safety Management (avg 5.5) - Safety certification
- Hotel Pastry & Baking (avg 5.3) - Creative industry
- Social Welfare (avg 5.4) - Social service career
- Hair Design (avg 5.5) - Beauty industry license
- Health & Welfare (avg 5.3)
- Dessert Cafe Entrepreneurship (avg 5.4) - Startup-oriented
- Culinary Entrepreneurship (Night) (avg 5.6) - Working students

## Grades 7-8 (Open Admission)
- Refrigeration & Air Conditioning - Practical technical training
- Marine Power Machinery - Shipbuilding industry
- AI Mechanical Control - Emerging technology
- Lifestyle & Culture Arts - Creative arts
- Aircraft Maintenance (Night) - Working students

## Special Programs
- Aircraft Maintenance (Night) - For working professionals
- Culinary Entrepreneurship (Night) - Evening classes available

## Notes
- All departments accept applications from international students
- Practical skills-focused programs recommended for grades 5-8
- Night programs available for working students
- Shuttle bus service available from Ulsan, Busan, Yangsan areas

# Department Contacts
- Nursing: Kim Song-soon (055-370-8243, 010-4662-6209)
- Optometry: Yoon Mi-ok (055-370-8214, 010-8931-7214)
- Health Administration: Lee Seung-jae (055-370-8197, 010-5895-4862)
- Aircraft Maintenance: Bae Gyu-han (055-370-8318, 010-6511-5235)
- Aircraft Maintenance (Night): Kim Seong-woo (055-370-8311, 010-5626-5877)
- Mechatronics: Lee Hak-won (055-370-8371, 010-3680-9833)
- Marine Power Machinery: Park Ji-eon (055-370-8290, 010-6585-3163)
- AI Mechanical Control: Lee Hak-won (055-370-8371, 010-3680-9833)
- Refrigeration & Air Conditioning: Lee Jung-hyun (055-370-8167, 010-8569-8819)
- Industrial Safety Management: Ko Kyung-chan (055-370-8195, 010-4570-6993)
- Hotel & Culinary Arts: Jang Yong-hyun (055-370-8146, 010-4561-2259)
- Culinary Entrepreneurship (Night): Jang Yong-hyun (055-370-8146, 010-4561-2259)
- Dessert Cafe Entrepreneurship: Koo Young-duk (055-370-8283, 010-5531-8283)
- Hotel Pastry & Baking: Jung Dong-yoon (055-370-8140, 010-3698-3835)
- Hair Design: Yoon Dae-soo (055-370-8184, 010-4097-4747)
- Early Childhood Education (3-year): Ha Jung-yeon (055-370-8136, 010-7582-0037)
- Social Welfare: Jo Jae-pil (055-370-8279, 010-6513-0697)
- Health & Welfare: Lee Sun-chan (055-370-8198, 010-2568-8367)
- Sports Rehabilitation & Exercise: Cho Young-gap (055-370-8270, 010-8818-5511)
- Professional Sports Coaching: Cho Young-gap (055-370-8270, 010-8818-5511)
- Lifestyle & Culture Arts: Ko Young-ho (055-370-8192, 010-2585-0206)
# Admissions Office: 055-370-8226~8

# Shuttle Bus Information (Contact: 010-2504-8884)
From Ulsan, Busan, Yangsan areas available.
`;

        let currentLanguage = 'ko';
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const languageBtn = document.getElementById('languageBtn');
        const languageModal = document.getElementById('languageModal');
        
        // ëŒ€í™” íˆìŠ¤í† ë¦¬ ì €ì¥ (ë¬¸ë§¥ ìœ ì§€)
        let conversationHistory = [];

        function updateUI() {
            const texts = UI_TRANSLATIONS[currentLanguage];
            document.getElementById('chatTitle').textContent = texts.chatTitle;
            document.getElementById('chatSubtitle').textContent = texts.chatSubtitle;
            userInput.placeholder = texts.inputPlaceholder;
            sendButton.textContent = texts.sendButton;
            languageBtn.textContent = texts.languageButton;
        }

        languageBtn.addEventListener('click', () => {
            languageModal.classList.add('active');
        });

        languageModal.addEventListener('click', (e) => {
            if (e.target === languageModal) {
                languageModal.classList.remove('active');
            }
        });

        document.querySelectorAll('.language-option').forEach(option => {
            option.addEventListener('click', () => {
                currentLanguage = option.dataset.lang;
                
                // ì–¸ì–´ ë³€ê²½ ì‹œ ëŒ€í™” íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”
                conversationHistory = [];
                
                updateUI();
                languageModal.classList.remove('active');
                
                document.querySelectorAll('.language-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                option.classList.add('selected');
                
                chatMessages.innerHTML = '';
                addMessage(WELCOME_MESSAGES[currentLanguage]);
            });
        });

        function formatPhoneNumbers(text) {
            text = text.replace(/(\d{3}-\d{3}-\d{4})/g, '<a href="tel:$1">ğŸ“ $1</a>');
            text = text.replace(/(\d{3}-\d{4}-\d{4})/g, '<a href="tel:$1">ğŸ“± $1</a>');
            return text;
        }

        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            if (!isUser) {
                content = formatPhoneNumbers(content);
            }
            
            contentDiv.innerHTML = content.replace(/\n/g, '<br>');
            messageDiv.appendChild(contentDiv);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showLoading() {
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message bot-message';
            loadingDiv.id = 'loading';
            loadingDiv.innerHTML = `
                <div class="message-content">
                    <span class="loading"></span>
                    <span class="loading"></span>
                    <span class="loading"></span>
                </div>
            `;
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeLoading() {
            const loading = document.getElementById('loading');
            if (loading) loading.remove();
        }

        async function sendToGemini(userMessage) {
            try {
                const languageInstructions = {
                    ko: 'You MUST answer ONLY in Korean (í•œêµ­ì–´). Do not mix any other languages.',
                    en: 'You MUST answer ONLY in English. Do not mix any other languages.',
                    zh: 'You MUST answer ONLY in Chinese (ä¸­æ–‡). Do not mix any other languages.',
                    vi: 'You MUST answer ONLY in Vietnamese (Tiáº¿ng Viá»‡t). Do not mix any other languages. When Vietnamese people ask about working in Korea and returning home, recommend practical departments like: Refrigeration & Air Conditioning, Smart Mechanical Electronics, Aircraft Maintenance, or Industrial Safety Management.',
                    ja: 'You MUST answer ONLY in Japanese (æ—¥æœ¬èª). Do not mix any other languages. Always write school name as æ±åœ’ç§‘å­¦æŠ€è¡“å¤§å­¦ (NOT æ±åŸ).',
                    uz: "You MUST answer ONLY in Uzbek (O'zbek tilida). Do not mix any other languages. When Uzbek people ask about working in Korea and returning home, recommend practical technical departments like: Refrigeration & Air Conditioning (Sovutish va konditsionerlash), Smart Mechanical Electronics (Aqlli mexanik elektronika), Aircraft Maintenance (Samolyot texnik xizmati), or Industrial Safety Management (Sanoat xavfsizligi).",
                    bn: 'You MUST answer ONLY in Bengali (à¦¬à¦¾à¦‚à¦²à¦¾). Do not mix any other languages. When Bangladeshi people ask about working in Korea and returning home, recommend practical departments.'
                };

                const systemPrompt = `You are an admissions counseling chatbot for Dongwon Institute of Science and Technology (DIST).

CRITICAL LANGUAGE INSTRUCTION: ${languageInstructions[currentLanguage]}

${ADMISSION_DATABASE}

Response Rules:
1. Keep answers concise (2-4 sentences) for mobile users
2. Recommend specific departments based on student needs
3. Always include hyphens in phone numbers (e.g., 055-370-8226)
4. Focus on practical information
5. Answer in the specified language ONLY
6. IMPORTANT: Use conversation history to understand context. If user asks follow-up questions like "ìê²©ì¦ì€?", "í•™ë¹„ëŠ”?", refer to the previous topic discussed.`;

                // ëŒ€í™” íˆìŠ¤í† ë¦¬ë¥¼ Gemini API í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                const contents = [];
                
                // ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ë¥¼ ì²« ë²ˆì§¸ ë©”ì‹œì§€ë¡œ
                if (conversationHistory.length === 0) {
                    contents.push({
                        role: 'user',
                        parts: [{ text: systemPrompt + '\n\nUser Question: ' + userMessage }]
                    });
                } else {
                    // ì´ì „ ëŒ€í™” íˆìŠ¤í† ë¦¬ í¬í•¨
                    contents.push({
                        role: 'user',
                        parts: [{ text: systemPrompt }]
                    });
                    
                    // ëŒ€í™” íˆìŠ¤í† ë¦¬ ì¶”ê°€
                    conversationHistory.forEach(msg => {
                        contents.push({
                            role: msg.role,
                            parts: [{ text: msg.text }]
                        });
                    });
                    
                    // í˜„ì¬ ì§ˆë¬¸ ì¶”ê°€
                    contents.push({
                        role: 'user',
                        parts: [{ text: userMessage }]
                    });
                }

                const response = await fetch(PROXY_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: contents,
                        generationConfig: {
                            temperature: 0.3,
                            maxOutputTokens: 1024,
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error('API ì˜¤ë¥˜');
                }
                
                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;
                
                // ëŒ€í™” íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
                conversationHistory.push({
                    role: 'user',
                    text: userMessage
                });
                conversationHistory.push({
                    role: 'model',
                    text: aiResponse
                });
                
                // ìµœëŒ€ ëŒ€í™” ì œí•œ (10í„´ = 20ê°œ ë©”ì‹œì§€)
                const MAX_CONVERSATIONS = 20;
                
                if (conversationHistory.length >= MAX_CONVERSATIONS) {
                    // ì œí•œ ë„ë‹¬ ì‹œ ì•Œë¦¼ ë©”ì‹œì§€ ì¶”ê°€
                    const limitMessages = {
                        ko: '\n\nâš ï¸ ëŒ€í™”ê°€ ë§ì•„ì ¸ ì‘ë‹µ í’ˆì§ˆì´ ì €í•˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nìƒˆë¡œìš´ ì§ˆë¬¸ì€ ì–¸ì–´ ë³€ê²½ ë˜ëŠ” í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ëŒ€í™”ë¥¼ ì´ˆê¸°í™”í•´ì£¼ì„¸ìš”.',
                        en: '\n\nâš ï¸ Too many conversations may affect response quality.\nPlease refresh the page or change language for new questions.',
                        zh: '\n\nâš ï¸ å¯¹è¯è¿‡å¤šå¯èƒ½å½±å“å›ç­”è´¨é‡ã€‚\nè¯·åˆ·æ–°é¡µé¢æˆ–æ›´æ”¹è¯­è¨€ä»¥å¼€å§‹æ–°å¯¹è¯ã€‚',
                        vi: '\n\nâš ï¸ QuÃ¡ nhiá»u cuá»™c trÃ² chuyá»‡n cÃ³ thá»ƒ áº£nh hÆ°á»Ÿng Ä‘áº¿n cháº¥t lÆ°á»£ng pháº£n há»“i.\nVui lÃ²ng lÃ m má»›i trang hoáº·c Ä‘á»•i ngÃ´n ngá»¯.',
                        ja: '\n\nâš ï¸ ä¼šè©±ãŒå¤šã™ãã‚‹ã¨å¿œç­”å“è³ªã«å½±éŸ¿ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\nãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã™ã‚‹ã‹è¨€èªã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚',
                        uz: '\n\nâš ï¸ Juda ko\'p suhbatlar javob sifatiga ta\'sir qilishi mumkin.\nIltimos, sahifani yangilang yoki tilni o\'zgartiring.',
                        bn: '\n\nâš ï¸ à¦…à¦¨à§‡à¦• à¦•à¦¥à§‹à¦ªà¦•à¦¥à¦¨ à¦‰à¦¤à§à¦¤à¦°à§‡à¦° à¦®à¦¾à¦¨ à¦ªà§à¦°à¦­à¦¾à¦¬à¦¿à¦¤ à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à§‡à¥¤\nà¦…à¦¨à§à¦—à§à¦°à¦¹ à¦•à¦°à§‡ à¦ªà§ƒà¦·à§à¦ à¦¾ à¦°à¦¿à¦«à§à¦°à§‡à¦¶ à¦•à¦°à§à¦¨ à¦¬à¦¾ à¦­à¦¾à¦·à¦¾ à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¨ à¦•à¦°à§à¦¨à¥¤'
                    };
                    
                    // ì˜¤ë˜ëœ ëŒ€í™” ì‚­ì œí•˜ê³  ìµœê·¼ ê²ƒë§Œ ìœ ì§€
                    conversationHistory = conversationHistory.slice(-MAX_CONVERSATIONS);
                    
                    // ì‘ë‹µì— ì•Œë¦¼ ì¶”ê°€
                    return aiResponse + limitMessages[currentLanguage];
                }
                
                return aiResponse;
            } catch (error) {
                console.error('Error:', error);
                
                // Worker URL ë¯¸ì„¤ì • ê°ì§€
                if (PROXY_API_URL.includes('YOUR-WORKER-NAME') || PROXY_API_URL.includes('YOUR-SUBDOMAIN')) {
                    const setupMessages = {
                        ko: 'âš ï¸ ì±—ë´‡ ì„¤ì •ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\nê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì‹œê±°ë‚˜ ì…í•™í™ë³´ì²˜ ğŸ“ 055-370-8226ìœ¼ë¡œ ì—°ë½ì£¼ì„¸ìš”.',
                        en: 'âš ï¸ Chatbot setup incomplete.\n\nPlease contact administrator or ğŸ“ 055-370-8226.',
                        zh: 'âš ï¸ èŠå¤©æœºå™¨äººè®¾ç½®æœªå®Œæˆã€‚\n\nè¯·è”ç³»ç®¡ç†å‘˜æˆ– ğŸ“ 055-370-8226ã€‚',
                        vi: 'âš ï¸ Thiáº¿t láº­p chatbot chÆ°a hoÃ n táº¥t.\n\nVui lÃ²ng liÃªn há»‡ quáº£n trá»‹ viÃªn hoáº·c ğŸ“ 055-370-8226.',
                        ja: 'âš ï¸ ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã®è¨­å®šãŒå®Œäº†ã—ã¦ã„ã¾ã›ã‚“ã€‚\n\nç®¡ç†è€…ã¾ãŸã¯ ğŸ“ 055-370-8226 ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚',
                        uz: 'âš ï¸ Chatbot sozlanmagan.\n\nIltimos, administrator yoki ğŸ“ 055-370-8226 bilan bog\'laning.',
                        bn: 'âš ï¸ à¦šà§à¦¯à¦¾à¦Ÿà¦¬à¦Ÿ à¦¸à§‡à¦Ÿà¦†à¦ª à¦¸à¦®à§à¦ªà§‚à¦°à§à¦£ à¦¹à¦¯à¦¼à¦¨à¦¿à¥¤\n\nà¦…à¦¨à§à¦—à§à¦°à¦¹ à¦•à¦°à§‡ à¦ªà§à¦°à¦¶à¦¾à¦¸à¦•à§‡à¦° à¦¸à¦¾à¦¥à§‡ à¦¯à§‹à¦—à¦¾à¦¯à§‹à¦— à¦•à¦°à§à¦¨ à¦¬à¦¾ ğŸ“ 055-370-8226à¥¤'
                    };
                    return setupMessages[currentLanguage];
                }
                
                const errorMessages = {
                    ko: 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì…í•™í™ë³´ì²˜ ğŸ“ 055-370-8226~8ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.',
                    en: 'An error occurred. Please contact ğŸ“ 055-370-8226~8.',
                    zh: 'å‘ç”Ÿé”™è¯¯ã€‚è¯·è”ç³» ğŸ“ 055-370-8226~8ã€‚',
                    vi: 'ÄÃ£ xáº£y ra lá»—i. Vui lÃ²ng liÃªn há»‡ ğŸ“ 055-370-8226~8.',
                    ja: 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ğŸ“ 055-370-8226~8 ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚',
                    uz: "Xatolik yuz berdi. ğŸ“ 055-370-8226~8 ga murojaat qiling.",
                    bn: 'à¦à¦•à¦Ÿà¦¿ à¦¤à§à¦°à§à¦Ÿà¦¿ à¦˜à¦Ÿà§‡à¦›à§‡à¥¤ à¦…à¦¨à§à¦—à§à¦°à¦¹ à¦•à¦°à§‡ ğŸ“ 055-370-8226~8 à¦ à¦¯à§‹à¦—à¦¾à¦¯à§‹à¦— à¦•à¦°à§à¦¨à¥¤'
                };
                return errorMessages[currentLanguage];
            }
        }

        async function handleSend() {
            const message = userInput.value.trim();
            if (!message) return;

            addMessage(message, true);
            userInput.value = '';
            sendButton.disabled = true;
            
            showLoading();
            const response = await sendToGemini(message);
            removeLoading();
            
            addMessage(response);
            sendButton.disabled = false;
        }

        sendButton.addEventListener('click', handleSend);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleSend();
        });
        
        userInput.addEventListener('focus', () => {
            setTimeout(() => {
                userInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 300);
        });

        // ëª¨ë°”ì¼ í‚¤ë³´ë“œ ëŒ€ì‘
        window.visualViewport?.addEventListener('resize', () => {
            const viewportHeight = window.visualViewport.height;
            document.body.style.height = `${viewportHeight}px`;
        });

        addMessage(WELCOME_MESSAGES[currentLanguage]);
        
        // ìƒë‹´ì‹ ì²­ ëª¨ë‹¬ í•¨ìˆ˜
        function openConsultModal() {
            updateConsultFormLanguage();
            document.getElementById('consultModal').classList.add('active');
        }
        
        function updateConsultFormLanguage() {
            const text = CONSULT_FORM_TEXT[currentLanguage];
            document.getElementById('consultTitle').textContent = text.title;
            document.getElementById('consultNameLabel').textContent = text.nameLabel;
            document.getElementById('consultName').placeholder = text.namePlaceholder;
            document.getElementById('consultPhoneLabel').textContent = text.phoneLabel;
            document.getElementById('consultPhone').placeholder = text.phonePlaceholder;
            document.getElementById('consultDeptLabel').textContent = text.deptLabel;
            document.getElementById('consultDeptPlaceholder').textContent = text.deptPlaceholder;
            document.getElementById('consultMessageLabel').textContent = text.messageLabel;
            document.getElementById('consultMessage').placeholder = text.messagePlaceholder;
            document.getElementById('cancelBtn').textContent = text.cancelBtn;
            document.getElementById('submitBtn').textContent = text.submitBtn;
        }
        
        function closeConsultModal() {
            document.getElementById('consultModal').classList.remove('active');
            // í¼ ì´ˆê¸°í™”
            document.getElementById('consultName').value = '';
            document.getElementById('consultPhone').value = '';
            document.getElementById('consultDept').value = '';
            document.getElementById('consultMessage').value = '';
        }
        
        function submitConsult() {
            const name = document.getElementById('consultName').value.trim();
            const phone = document.getElementById('consultPhone').value.trim();
            const dept = document.getElementById('consultDept').value;
            const message = document.getElementById('consultMessage').value.trim();
            
            // ìœ íš¨ì„± ê²€ì‚¬
            if (!name) {
                alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!phone) {
                alert('ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!dept) {
                alert('ê´€ì‹¬ í•™ê³¼ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì „í™”ë²ˆí˜¸ í˜•ì‹ ê²€ì‚¬
            const phonePattern = /^01[0-9]-?[0-9]{3,4}-?[0-9]{4}$/;
            if (!phonePattern.test(phone.replace(/-/g, ''))) {
                alert('ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.\nì˜ˆ: 010-1234-5678');
                return;
            }
            
            // í•´ë‹¹ í•™ê³¼ êµìˆ˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const professor = PROFESSORS[dept];
            
            if (!professor) {
                alert('í•´ë‹¹ í•™ê³¼ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // SMS ë‚´ìš© ìƒì„±
            const languageMessages = {
                ko: `[ë™ì›ê³¼ê¸°ëŒ€ ìƒë‹´ì‹ ì²­]
í•™ê³¼: ${dept}
ì´ë¦„: ${name}
ì—°ë½ì²˜: ${phone}${message ? '\në¬¸ì˜: ' + message : ''}`,
                en: `[DIST Consultation Request]
Dept: ${dept}
Name: ${name}
Phone: ${phone}${message ? '\nInquiry: ' + message : ''}`,
                zh: `[ä¸œå›­ç§‘æŠ€å¤§å­¦å’¨è¯¢ç”³è¯·]
ä¸“ä¸š: ${dept}
å§“å: ${name}
ç”µè¯: ${phone}${message ? '\nå’¨è¯¢: ' + message : ''}`,
                vi: `[YÃªu cáº§u tÆ° váº¥n DIST]
Khoa: ${dept}
TÃªn: ${name}
SÄT: ${phone}${message ? '\nHá»i: ' + message : ''}`,
                ja: `[æ±åœ’ç§‘æŠ€å¤§å­¦ç›¸è«‡ç”³è«‹]
å­¦ç§‘: ${dept}
åå‰: ${name}
é›»è©±: ${phone}${message ? '\nãŠå•ã„åˆã‚ã›: ' + message : ''}`,
                uz: `[DIST maslahat so'rovi]
Bo'lim: ${dept}
Ism: ${name}
Tel: ${phone}${message ? '\nSavol: ' + message : ''}`,
                bn: `[DIST à¦ªà¦°à¦¾à¦®à¦°à§à¦¶ à¦…à¦¨à§à¦°à§‹à¦§]
à¦¬à¦¿à¦­à¦¾à¦—: ${dept}
à¦¨à¦¾à¦®: ${name}
à¦«à§‹à¦¨: ${phone}${message ? '\nà¦…à¦¨à§à¦¸à¦¨à§à¦§à¦¾à¦¨: ' + message : ''}`
            };
            
            const smsContent = encodeURIComponent(languageMessages[currentLanguage]);
            const professorPhone = professor.phone.replace(/-/g, '');
            
            // SMS ì•± ì—´ê¸°
            window.location.href = `sms:${professorPhone}?body=${smsContent}`;
            
            // ëª¨ë‹¬ ë‹«ê¸°
            closeConsultModal();
            
            // í™•ì¸ ë©”ì‹œì§€
            const confirmMessages = {
                ko: `âœ… ${dept} ${professor.name} êµìˆ˜ë‹˜ê»˜ ìƒë‹´ ë¬¸ìê°€ ì „ì†¡ë©ë‹ˆë‹¤.\n\në¬¸ìì•±ì—ì„œ ì „ì†¡ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!`,
                en: `âœ… Consultation SMS will be sent to Prof. ${professor.name} (${dept}).\n\nPlease press send in your SMS app!`,
                zh: `âœ… å°†å‘${dept}çš„${professor.name}æ•™æˆå‘é€å’¨è¯¢çŸ­ä¿¡ã€‚\n\nè¯·åœ¨çŸ­ä¿¡åº”ç”¨ä¸­æŒ‰å‘é€ï¼`,
                vi: `âœ… Tin nháº¯n tÆ° váº¥n sáº½ Ä‘Æ°á»£c gá»­i Ä‘áº¿n GS ${professor.name} (${dept}).\n\nVui lÃ²ng nháº¥n gá»­i trong á»©ng dá»¥ng tin nháº¯n!`,
                ja: `âœ… ${dept}ã®${professor.name}æ•™æˆã«ç›¸è«‡SMSãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚\n\nSMSã‚¢ãƒ—ãƒªã§é€ä¿¡ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ï¼`,
                uz: `âœ… ${dept} ${professor.name} professoriga maslahat SMS yuboriladi.\n\nSMS ilovasida yuborish tugmasini bosing!`,
                bn: `âœ… ${dept} à¦à¦° à¦…à¦§à§à¦¯à¦¾à¦ªà¦• ${professor.name} à¦•à§‡ à¦ªà¦°à¦¾à¦®à¦°à§à¦¶ SMS à¦ªà¦¾à¦ à¦¾à¦¨à§‹ à¦¹à¦¬à§‡à¥¤\n\nSMS à¦…à§à¦¯à¦¾à¦ªà§‡ à¦ªà¦¾à¦ à¦¾à¦¨ à¦¬à§‹à¦¤à¦¾à¦® à¦Ÿà¦¿à¦ªà§à¦¨!`
            };
            
            addMessage(confirmMessages[currentLanguage]);
        }
    </script>
</body>
</html>
